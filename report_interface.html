<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Data Extractor</title>
    <style>
        :root {
            --primary: #000000;
            --secondary: #1f2937;
            --bg: #ffffff;
            --text: #111827;
            --radius: 0.5rem;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background: #ffffff;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            color: var(--text);
            border-bottom: 2px solid #e5e7eb;
        }
        header img {
            height: 60px;
            margin-right: 1rem;
        }
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2rem 1rem;
        }
        .uploader {
            background: #fff;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 500px;
        }
        .uploader label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        .uploader input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: var(--radius);
        }
        button {
            margin-top: 1rem;
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            border: none;
            color: #fff;
            font-size: 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background 0.2s ease;
        }
        button:hover {
            background: #333333;
        }
        #output {
            margin-top: 2rem;
            width: 100%;
            max-width: 800px;
            background: #fff;
            border-radius: var(--radius);
            padding: 1rem;
            white-space: pre-wrap;
            overflow-x: auto;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.875rem;
            background: #e2e8f0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #cbd5e1;
            padding: 0.5rem;
            text-align: left;
        }
        th {
            background: #f1f5f9;
        }
        /* Brand tweaks */
        header div {
            display: flex;
            flex-direction: column;
        }
        .tagline {
            margin: 0;
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex flex-col bg-gray-50 text-gray-900">
    <header class="bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-md px-6 py-4 flex items-center">
        <img src="logo t.jpg" alt="Technova Hub Logo" class="w-16 h-16 md:w-20 md:h-20 object-contain mr-4" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" />
        <svg width="56" height="56" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="mr-4 flex-shrink-0" style="display:none">
  <rect width="64" height="64" fill="#000" rx="8"/>
  <text x="32" y="38" font-family="sans-serif" font-size="10" font-weight="bold" fill="#fff" text-anchor="middle">TH</text>
</svg>
        <div>
            <h1>Technova Hub</h1>
            <p class="text-sm text-white/80">Empowering Minds&nbsp;|&nbsp;PDF&nbsp;Data&nbsp;Extractor</p>
        </div>
        <nav class="ml-auto">
            <a href="dashboard.html" class="text-white/90 font-semibold hover:text-white">Dashboard</a>
        </nav>
    </header>

    <main>
        <section class="bg-white rounded-lg shadow-md p-8 w-full max-w-md">
            <label for="pdfInput" class="block text-sm font-medium text-gray-700">Select PDF Report</label>
            <input type="file" id="pdfInput" accept="application/pdf" class="mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100" />
            <button id="uploadBtn" class="mt-4 w-full py-3 bg-gradient-to-r from-violet-600 to-indigo-600 text-white rounded-lg hover:opacity-90 disabled:opacity-50">Extract Data</button>
        </section>

        <section id="output" style="display:none;"></section>
    </main>

    <footer>
        &copy; <span id="year"></span> Your Company. All rights reserved.
    </footer>

    <script>
        // Update footer year automatically
        document.getElementById('year').textContent = new Date().getFullYear();

        const webhookUrl = 'https://technova112.app.n8n.cloud/webhook/extract-report';
        const pdfInput = document.getElementById('pdfInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const output = document.getElementById('output');

        function displayData(data) {
            if (typeof data === 'object') {
                // Display JSON as a table
                let html = '<table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>';
                for (const [key, value] of Object.entries(data)) {
                    html += `<tr><td>${key}</td><td>${value}</td></tr>`;
                }
                html += '</tbody></table>';
                output.innerHTML = html;
            } else {
                output.textContent = data;
            }
            output.style.display = 'block';
        }

        async function saveHistory(filename, data) {
            try {
                const response = await fetch('http://localhost:5000/api/extractions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filename,
                        data_json: JSON.stringify(data),
                        mime_type: 'application/pdf',
                        status: 'success'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save extraction');
                }
                
                const result = await response.json();
                console.log('Extraction saved:', result);
            } catch (error) {
                console.error('Could not save history:', error);
            }
        }

        uploadBtn.addEventListener('click', async () => {
            const file = pdfInput.files[0];
            if (!file) {
                alert('Please select a PDF file first.');
                return;
            }
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploadingâ€¦';
            output.style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('file', file, file.name);

                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error(`Server responded with ${response.status}`);
                }

                // Try to parse JSON; fallback to text
                const text = await response.text();
                let parsed;
                try {
                    parsed = JSON.parse(text);
                } catch (err) {
                    parsed = text;
                }

                displayData(parsed);
                await saveHistory(file.name, parsed);
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
                output.style.display = 'block';
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Extract Data';
            }
        });
    </script>
</body>
</html>
